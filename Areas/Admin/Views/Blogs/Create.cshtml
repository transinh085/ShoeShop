@model ShoeShop.ViewModels.BlogViewModel;

@{
    ViewData["Title"] = "Create";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}
@section Styles {
    <link rel="stylesheet" href="~/admin/js/plugins/select2/css/select2.min.css">
}

@section Scripts {
    <script src="~/admin/js/plugins/select2/js/select2.full.min.js"></script>
    <script src="~/admin/js/plugins/ckeditor/ckeditor.js"></script>
    <script src="~/admin/js/plugins/jquery-validation/jquery.validate.min.js"></script>
    <script src="~/admin/js/plugins/jquery-validation/additional-methods.js"></script>
    <script>Dashmix.helpersOnLoad(['jq-select2', 'js-ckeditor']);</script>
    <script src="~/admin//js/blog/add-blog.js"></script>
    <script>
        $(document).ready(function () {
            $('#blog-form').submit(function (e) {
                e.preventDefault();

                var formData = new FormData($(this)[0]);

                formData.append('Content', CKEDITOR.instances['js-ckeditor'].getData());

                for (let [key, value] of formData.entries()) {
                    console.log(`${key}: ${value}`);
                }

                // AJAX request to submit form
                $.ajax({
                    url: '/Admin/Blogs/Create',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        window.location.href = '/Admin/Blogs/Index';
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            });
        });

    </script>
}


<form asp-action="Create" id="blog-form" enctype="multipart/form-data">
    <div asp-validation-summary="All" class="text-danger"></div>
    <div class="col-8" style="background-color:white;display:block; margin:10px 250px">
        <div class="block-header block-header-default" style="width:100%">
            <h3 class="block-header-default" style="margin:10px">Add Post</h3>
        </div>
        <div class="col-8" style="width:100%;padding:10px 100px">
            <div class="form-group" >
                <label class="form-label" asp-for="Image">Image</label>
                <input type="file" id="thumbnail" asp-for="Image" class="form-control" accept="image/*" />
                <img id="imagePreview" style="display:none; width: 400px; height: 350px; margin:10px 60px " />
            </div>

            <div class="form-group">
                <label asp-for="Name" class="control-label"></label>
                <input asp-for="Name" class="form-control" id="blog-name" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Slug" class="control-label"></label>
                <input asp-for="Slug" class="form-control" id="blog-slug" />
                <span asp-validation-for="Slug" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label class="form-label" asp-for="TopicId">Topic</label>
                <select class="js-select2 form-select" id="topic-id" asp-for="TopicId" style="width: 100%;" data-placeholder="Choose topic..">
                    <option></option>
                    @foreach (var topic in ViewBag.Topics)
                    {
                        <option value="@topic.Id">@topic.Name</option>
                    }
                    <!-- Add dynamic options if needed -->
                </select>
            </div>

            <div class="form group">
                <label class="form-label">Content</label>
                <textarea id="js-ckeditor"></textarea>
            </div>
            <div class="form-group" style="display:flex;justify-content:end;padding:10px 30px">
                <div class="form-check form-check form-switch">
                    <input asp-for="IsPublic" class="form-check-input" type="checkbox" id="flexSwitchCheckDefault" />
                </div>
                <label asp-for="IsPublic" class="control-label"></label>
            </div>
            <div class="mb-4 form-group" style="display:flex;justify-content:end;padding:10px 10px">
                <button type="button" class="btn btn-danger" style="margin:10px"> <a asp-action="Index" style="color:white">Back to List</a></button>
                <button type="submit" value="Create" id="btn-add-blog" class="btn btn-primary" style="margin:10px">Create Post</button>
            </div>


        </div>
    </div>
</form>
